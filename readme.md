# Отчет по лабораторной работе №4 по предмету "Функциональное программирование"

> Выполнил: студент группы P3319 Бардин Петр Алексеевич

## Постановка задачи

Разработать фронтенд для LLVM для трансляции C в LLVM IR.

- реализованная поддержка функционала языка:
  - целочистенные, символьные типы, строки
  - операторы унарные, бинарные
  - локальные переменные, операторы присваивания
  - функции, прототипы функций, параметры и возвращаемые значение
  - условные операторы
  - циклы for, while

## Реализация

При разработке использованы ocamllex и menhir (расширение ocamlyacc), они позволяют определить лексику и грамматику языка в формате, приближенном к классическим lex, yacc. Парсер разработан так, что он выдает абстрактное синтаксическое дерево при разборе кода. Далее на основе исходного дерева строится код на IR. Для этого используются биндинги к официальной библиотеке llvm. Генерация выполняется в один проход по дереву, при разворачивании выражений от листьев, каждая операция создает новый регистр со значением, вычисленным операцией от листьев, таким образом, проход по дереву создает SSA форму. Для работы с локаьными переменными используется размещение локальных переменных на стеке при помощи alloca, и затем они используются через load/store, что в оптимизаторе IR хорошо сворачивается в регистровую форму. При проходе по дереву заполняется контексты локальных и глобальных переменных, в глобальном - функции, определнные (или задекларированные) выше данного выражения, в локальном - для каждой фукнции хранятся переменные оперделенные выше данного выражения, причем не обязательно заранее. При выполнении присваиваний, парсер допускает любые выражения слева, но при трансляции ветка для левого выражения рекурсивно обходится иным транслятором чем для обычных выражений, чтобы обеспечить, что туда действительно можно писать.

Код:
- [lexer](bin/c_lang/c_lexer.mll)
- [parser](bin/c_lang/c_parser.mly)
- [ast](bin/c_lang/c_syntax.ml)
- [ir](bin/c_lang/c_fe.ml)

## Пример работы

Для системы написаны тесты на 4 уровнях:
- лексер [test_parse.ml](bin/c_lang/test_parse.ml)
- парсер [test_parse.ml](bin/c_lang/test_parse.ml)
- транслятор в ir [test_fe.ml](bin/c_lang/test_fe.ml)
- интеграционный с полным процессом компиляции [test_fe.ml](bin/c_lang/test_fe.ml)

## Вывод

Был успешно написан минимальный рабочий фронтенд для языка С и проверена его интеграция с существующей инфраструктурой llvm, написаны тесты для всех трех уровней работы системы. В ходе работы удалось изучить устройство генераторов парсеров и применить их на практике, а также уделено особое внимание построению синтаксического дерева и его обходу.